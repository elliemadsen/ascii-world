<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>space</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: "Courier New", monospace;
      }
    </style>
  </head>
  <body>
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.164/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164/examples/jsm/"
        }
      }
    </script>

    <script type="module">
      import * as THREE from "three";
      import { PointerLockControls } from "three/addons/controls/PointerLockControls.js";
      import { AsciiEffect } from "three/addons/effects/AsciiEffect.js";
      import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";
      import { Water } from "three/addons/objects/Water.js";
      import { TextureLoader } from "three";
      import { OBJLoader } from "https://cdn.jsdelivr.net/npm/three@0.161.0/examples/jsm/loaders/OBJLoader.js";

      let camera, scene, renderer, effect, controls;
      const keys = {};
      let asciiEnabled = true;
      const spheres = [];
      const numSpheres = 50;

      init();
      animate();

      function init() {
        // --- Scene ---
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000);

        // --- Camera ---
        camera = new THREE.PerspectiveCamera(
          75,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        camera.position.set(0, 0, 0);

        // --- Lights ---

        // Harsh directional sunlight
        const sunLight = new THREE.DirectionalLight(0xffffff, 2);
        sunLight.position.set(50, 80, -50);
        scene.add(sunLight);

        const sunLight2 = new THREE.DirectionalLight(0xffffff, 2);
        sunLight.position.set(0, -40, 0);
        scene.add(sunLight2);

        // Ambient fill light
        const ambient = new THREE.AmbientLight(0x333333);
        scene.add(ambient);

        // Spheres

        const textures = ["moon.jpg", "dots.png", "pattern.png"];

        for (let i = 0; i < numSpheres; i++) {
          const loader = new THREE.TextureLoader();
          let texture = textures[i % textures.length];
          console.log("Texture: " + texture);
          loader.load(`landscape/${texture}`, (texture) => {
            const radius = Math.random() + 0.05;
            const geometry = new THREE.SphereGeometry(radius, 16, 16);
            const material = new THREE.MeshStandardMaterial({
              map: texture,
              roughness: 1.0,
              metalness: 0.0,
            });
            const sphere = new THREE.Mesh(geometry, material);

            // Random distance and angle from the origin (camera)
            sphere.userData = {
              distance: Math.random() * 20 + 2,
              angle: Math.random() * Math.PI * 2,
              speed: Math.random() * 0.0004 + 0.0005, // radians per frame
            };

            // Initial position
            sphere.position.x =
              sphere.userData.distance * Math.cos(sphere.userData.angle);
            sphere.position.z =
              sphere.userData.distance * Math.sin(sphere.userData.angle);
            sphere.position.y = (Math.random() - 0.5) * 6;

            scene.add(sphere);
            spheres.push(sphere);
          });
        }

        // --- Renderer & ASCII ---
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // " .,!%$#@"
        effect = new AsciiEffect(renderer, " .,iraetb174VO8XM", {
          invert: true,
          resolution: 0.2,
        });
        effect.setSize(window.innerWidth, window.innerHeight);
        effect.domElement.style.color = "white";
        effect.domElement.style.backgroundColor = "black";
        effect.domElement.style.fontFamily = '"Courier New", monospace';
        effect.domElement.style.pointerEvents = "none";
        document.body.appendChild(effect.domElement);

        // --- Controls ---
        controls = new PointerLockControls(camera, document.body);
        document.body.addEventListener("click", () => {
          controls.lock();
        });

        document.addEventListener("keydown", (e) => (keys[e.key] = true));
        document.addEventListener("keyup", (e) => (keys[e.key] = false));

        window.addEventListener("keydown", (e) => {
          if (e.code === "Space") {
            e.preventDefault();
            window.location.href = "computernude.html";
          }
        });
        // Toggle ASCII on/off
        window.addEventListener("keydown", (e) => {
          if (e.key === "a") asciiEnabled = !asciiEnabled;
        });

        window.addEventListener("resize", onWindowResize);
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        effect.setSize(window.innerWidth, window.innerHeight);
      }

      function animate() {
        requestAnimationFrame(animate);

        // --- Camera movement ---
        const speed = 0.2;
        if (keys["ArrowUp"]) controls.moveForward(speed);
        if (keys["ArrowDown"]) controls.moveForward(-speed);
        if (keys["ArrowLeft"]) controls.getObject().rotation.y += 0.03;
        if (keys["ArrowRight"]) controls.getObject().rotation.y -= 0.03;

        spheres.forEach((sphere) => {
          sphere.userData.angle += sphere.userData.speed;
          sphere.position.x =
            sphere.userData.distance * Math.cos(sphere.userData.angle);
          sphere.position.z =
            sphere.userData.distance * Math.sin(sphere.userData.angle);
        });

        // --- Render ASCII or normal ---
        if (asciiEnabled) {
          effect.render(scene, camera);
          effect.domElement.style.display = "block";
          renderer.domElement.style.display = "none";
        } else {
          renderer.render(scene, camera);
          effect.domElement.style.display = "none";
          renderer.domElement.style.display = "block";
        }
      }
    </script>
  </body>
</html>
